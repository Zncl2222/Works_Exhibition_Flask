{% extends "base.html" %}

{% block title %}Testing{% endblock %}

{% block main %}
<title>Statistic</title>
<head>
    <style type="text/css">
        .page-item{
            display:inline-block;
            margin:1rem;
        }

    </style>

</head>
<body>
    
    <div class="jumbotron" style="width: 110rem; height: 13rem">
        <h2>Records (sgsim)</h2>
        <p>This is a records of the user statistics</p>
        <span style="font-weight:bold;">Author: Zncl2222</span>
        <br>
        <br><br>
    </div>
    
    <div id="container" style="width: 100%;height:50rem; padding-top:5rem ;"></div>
    
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script>
        function changeTimezone(date, ianatz) {


            var invdate = new Date(date.toLocaleString('en-US', {
                timeZone: ianatz
            }));

            var diff = date.getTime() - invdate.getTime();

            return new Date(date.getTime() - diff);

        }

        var date_data =[];
        var unique_visitors = [];
        let here = new Date()
        var now_date = changeTimezone(here, 'Asia/Taipei')
        console.log(now_date);
        now_date.setMonth(now_date.getMonth()-1);

        console.log(now_date);
        {% for item in unique_visited %}

        unique_visitors.push({{item}});
        {% endfor %}

        {% for item in count %}
        
        date_data.push({{item}});

        {% endfor %}
        console.log(date_data);
        
        Highcharts.chart('container', {
        title: {
            text: 'Monthly count'
        },

        yAxis: {
            title: {
                text: 'Counts',
                style:{
                    fontSize:"1.5rem"
                }
            },
            labels:{
                    style:{
                        fontSize:"1.5rem",
                        color:'Black'
                    }
                }
        },

        xAxis: {
            type: 'datetime',
            dateTimeLabelFormats: { // don't display the dummy year
                month: '%e. %b',
                year : '%b',
            },
            title: {
                text: 'Date',
                style:{
                    fontSize:"1.5rem"
                }
            },
            labels:{
                    style:{
                        fontSize:"1.0rem",
                        color:'Black'
                    }
                }
        },

        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle'
        },
        plotOptions: {
            line: {
                dataLabels: {
                    enabled: true
                },
                enableMouseTracking: false
            },

        },
        series: [
            {
                name: 'sgsim_counts',
                pointInterval: 24 * 3600 * 1000,
                pointStart: now_date.getTime(),
                data: date_data,
            },
            {  
                name: 'unique_visitors',
                pointInterval: 24 * 3600 * 1000,
                pointStart: now_date.getTime(),
                data: unique_visitors,
            },
        ],

        responsive: {
            rules: [{
                condition: {
                    maxWidth: 500
                },
                chartOptions: {
                    legend: {
                        layout: 'horizontal',
                        align: 'center',
                        verticalAlign: 'bottom'
                    }
                }
            }]
        }

        });

       
    </script>


</body>

<nav aria-label="Page navigation">
    <ul class="pagination">
      <li class="page-item"><a class="page-link" href="/statistic">Frequency</a></li>
      <li class="page-item"><a class="page-link" href="/statistic/count">Distinction</a></li>
      <li class="page-item"><a class="page-link" href="/statistic/date">Date</a></li>
    </ul>
  </nav>

{% endblock %}